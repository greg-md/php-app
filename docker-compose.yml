version: '3'
services:
  app:
    build: .
    container_name: app
    volumes:
      - .:/var/www/app
      - ./build-deploy/nginx/ssl:/etc/nginx/ssl
      - ./build-deploy/nginx/domains.d:/etc/nginx/domains.d
      - ./build-deploy/nginx/serve.d:/etc/nginx/serve.d
    env_file: .env
    command: build-deploy/run.sh
    depends_on:
      - mysql
      - redis
    links:
      - mysql
      - redis
    networks:
      app:
        aliases:
          - app.local
    ports:
      - "80:80"
      - "443:443"
  mysql:
    image: percona:5.7
    env_file: .env
    networks:
      app:
        aliases:
          - mysql.app.local
    ports:
      - "3306:3306"
  redis:
    image: redis:3.2
    networks:
      app:
        aliases:
          - redis.app.local
    ports:
      - "6379:6379"
networks:
  app: